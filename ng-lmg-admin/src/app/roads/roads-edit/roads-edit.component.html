<div class="container">
  <div class="row">
    <div class="col-8">
      <h1 class="display-3">Edit a road</h1>
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      <h2>Basic information</h2>
      <form (ngSubmit)="onSubmit()" [formGroup]="roadsForm">
        <div>
          <mat-form-field appearance="outline">
            <mat-label>Name</mat-label>
            <input autofocus formControlName="name" matInput placeholder="Name of the route">
            <mat-hint>eg. 'Magical Cracow discovery'</mat-hint>
          </mat-form-field>
        </div>
        <div>
          <mat-form-field appearance="outline">
            <mat-label>Decoy</mat-label>
            <input #decoy autofocus formControlName="decoy" matInput placeholder="Decoy">
            <mat-hint>Something that will attract tourist to click.</mat-hint>
            <mat-hint align="end">{{decoy.value?.length || 0}}/250</mat-hint>
          </mat-form-field>
        </div>
        <div>
          <mat-form-field appearance="outline">
            <mat-label>Description</mat-label>
            <textarea #description formControlName="description" matInput placeholder="Textarea"></textarea>
            <mat-hint align="end">{{description.value?.length || 0}}/250</mat-hint>
            <mat-hint>Description is what should encourage tourist to take the selected route.
            </mat-hint>
          </mat-form-field>
        </div>
        <div class="w-90">
          <!--map-->
          <app-map-search (notifyPosition)="onResultClick($event)" *ngIf="this.roadLocationName"
                          [locationName]="this.roadLocationName" id="map-search"></app-map-search>
          <div id="mapid"></div>
        </div>
        <div class="w-90 targets">
          <hr>
          <h2 #targets id="targets">Targets</h2>
          <p>Please move the targets in order the user will go.</p>
          <button type="button" (click)="this.triggerPointsSelectorModal()"  mat-button color="primary">Add new targets</button>
          <mat-accordion (cdkDropListDropped)="moveTarget($event)" cdkDropList class="example-headers-align">
            <mat-expansion-panel *ngFor="let target of targetsArray; let i = index " cdkDrag>
              <mat-expansion-panel-header>
                <mat-panel-title>
                  {{i + 1}}  {{target['point']['name']}}
                </mat-panel-title>
                <mat-panel-description>
                  {{target['point']['description'] | slice: 0:100}}...
                </mat-panel-description>
              </mat-expansion-panel-header>
              <mat-divider></mat-divider>

              Location:
              <div class="target-description">{{target['point']['location']['name']}}</div>
              Code:
              <div class="target-description">{{target['point']['code']}}</div>
              Sightseeing description:
              <div class="target-description">{{target['explore_tip']}}</div>
              Challenge description:
              <div class="target-description">{{target['challenge_tip']}}</div>


              <mat-action-row>
                <button color="warn" type="button" mat-button (click)="this.triggerTargetEditModal()">Edit
                </button>
                <button (click)="removeTargetFromRoad(i)" color="warn" mat-button type="button">Remove from the road
                </button>
              </mat-action-row>
            </mat-expansion-panel>
          </mat-accordion>
          <div id="loop-checkbox">
            <mat-checkbox formControlName="loop" matTooltip="Looping gives a user option to start a road
          from the middle without going back to the first point">Loop the targets
            </mat-checkbox>
          </div>
        </div>
        <hr>
        <button (click)="publishRoad(this.is_published)" color="primary" mat-stroked-button
                type="button">{{this.is_published === true ? "Withhold" : "Publish"}}</button>
        <button color="primary" mat-stroked-button type="submit">Save changes</button>
        <button (click)="removeRoad()" color="warn" mat-stroked-button type="button">Delete</button>
        <button [routerLink]="['/roads']" mat-stroked-button type="button">Cancel</button>
      </form>
    </div>
  </div>
  <app-mat-spinner-overlay *ngIf="spinner" overlay="true"></app-mat-spinner-overlay>
</div>
